var sucessRequests=0,totalRequests=0,name="";!function(l){"use strict";l(document).ready(function(){t.init(),e.init()});var t={importData:{},allowPopupClosing:!0,init:function(){var e=this;this.categoriesFilter(),l(".owp-search-input").on("keyup",function(){0<l(this).val().length?(l(".owp-demo-wrap .themes").find(".theme-wrap").hide(),l(".owp-demo-wrap .themes").find('.theme-wrap[data-name*="'+l(this).val().toLowerCase()+'"]').show()):l(".owp-demo-wrap .themes").find(".theme-wrap").show()}),l(".owp-demo-wrap .theme-actions a.button").on("click",function(t){t.stopPropagation()}),l(".owp-open-popup").click(function(t){l(this).hasClass("active")?(l(this).removeClass("active"),l(".install-demos-button").addClass("disabled"),l(".install-demos-button").attr("disabled",!0)):(l(".owp-open-popup").removeClass("active"),l(this).addClass("active"),l(".install-demos-button").removeClass("disabled"),l(".install-demos-button").attr("disabled",!1))}),l(".install-demos-button").click(function(t){t.preventDefault(),0<l(".owp-open-popup.active").length?(t=l(".owp-open-popup.active:first").data("demo-id"),l(".preview-"+t),l(".preview-all-"+t),l(".demo-import-loader").show(),e.getDemoData(t)):window.location.href=l(this).attr("data-next_step")}),l(document).on("click",".install-now",this.installNow),l(document).on("click",".activate-now",this.activatePlugins),l(document).on("wp-plugin-install-success",this.installSuccess),l(document).on("wp-plugin-installing",this.pluginInstalling),l(document).on("wp-plugin-install-error",this.installError)},categoriesFilter:function(){function o(o){var t,a=l.Deferred();return(t=l.Deferred(),i.addClass(e),setTimeout(function(){i.removeClass(e).hide(),t.resolve()},200),t.promise()).done(function(){var t,e;t=o,e=a,i.filter("all"===t?"div":t?'[data-categories*="'+t+'"]':"div").show().addClass("owp-is-fadein"),setTimeout(function(){i.removeClass("owp-is-fadein"),e.resolve()},200)}),a}var i=l(".owp-demo-wrap .themes").find(".theme-wrap"),e="owp-is-fadeout";l(".owp-navigation-link").on("click",function(t){t.preventDefault(),l(this).parent().siblings().removeClass("active"),l(this).parent().addClass("active");var t=this.hash.slice(1),e=l(".owp-demo-wrap .themes");e.css("min-width",e.outerHeight()),o(t).done(function(){e.removeAttr("style")})})},getDemoData:function(t){var e=this;l.ajax({url:owpDemos.ajaxurl,type:"get",data:{action:"owp_ajax_get_import_data",demo_name:t,security:owpDemos.owp_import_data_nonce},complete:function(t){l(".demo-import-loader").hide(),e.importData=l.parseJSON(t.responseText)}}),l.ajax({url:owpDemos.ajaxurl,type:"get",data:{action:"owp_wizard_ajax_get_demo_data",demo_name:t,demo_data_nonce:owpDemos.demo_data_nonce},complete:function(t){console.log(t),l(".owp-demo-wrap").html(t.responseText),l("html,body").animate({scrollTop:l("#owp-demo-plugins").offset().top},500),e.runPopup(t)}})},runPopup:function(t){var a=this;l(".owp-demo-popup-close, .owp-demo-popup-overlay").on("click",function(t){t.preventDefault(),!0===a.allowPopupClosing&&a.closePopup()}),l(".owp-plugins-next").on("click",function(t){t.preventDefault(),l("#owp-demo-plugins").hide(),l("#owp-demo-import-form").show()}),l("#owp-demo-import-form").submit(function(t){t.preventDefault();var e=l(this).find('[name="owp_import_demo"]').val(),t=l(this).find('[name="owp_import_demo_data_nonce"]').val(),o=[];l(this).find('input[type="checkbox"]').each(function(){!0===l(this).is(":checked")&&o.push(l(this).attr("name"))}),l(this).hide(),l(".owp-loader").show(),l("#owp-demo-import-form,#owp-demo-plugins").hide(),totalRequests=o.length,a.importContent({demo:e,nonce:t,contentToImport:o,isXML:l("#owp_import_xml").is(":checked")})})},importContent:function(s){var t,e,n=this,o=(Date.now(),{owp_import_demo:s.demo,owp_import_demo_data_nonce:s.nonce});if(this.allowPopupClosing=!1,l(".owp-demo-popup-close").fadeOut(),0===s.contentToImport.length){if(sucessRequests==totalRequests)return setTimeout(function(){l(".owp-loader").hide(),l(".owp-last").show(),window.location.href=l(".wizard-install-demos-buttons-wrapper.final-step .skip-btn").attr("href")},1e3),l.ajax({url:owpDemos.ajaxurl,type:"post",data:{action:"owp_after_import",owp_import_demo:s.demo,owp_import_demo_data_nonce:s.nonce,owp_import_is_xml:s.isXML},complete:function(t){}}),this.allowPopupClosing=!0,void l(".owp-demo-popup-close").fadeIn();l(".owp-loader").hide(),l(".owp-error").show(),l(".wizard-install-demos-buttons-wrapper.final-step").show()}for(e in this.importData){var a=l.inArray(this.importData[e].input_name,s.contentToImport);if(-1!==a){t=e,s.contentToImport.splice(a,1),o.action=this.importData[e].action;break}}l(".owp-import-status").append('<p class="owp-importing">'+this.importData[t].loader+"</p>");var i=l.ajax({url:owpDemos.ajaxurl,type:"post",data:o,complete:function(t){clearTimeout(p);var e=!0;if(500===t.status||502===t.status||503===t.status)l(".owp-importing").addClass("owp-importing-failed").removeClass("owp-importing").text(owpDemos.content_importing_error+" "+t.status);else if(-1!==t.responseText.indexOf("successful import"))l(".owp-importing").addClass("owp-imported").removeClass("owp-importing"),sucessRequests++;else{var o,a=l.parseJSON(t.responseText),i="";for(o in a)i+=a[o],"xml_import_error"===o&&(e=!1);l(".owp-importing").addClass("owp-importing-failed").removeClass("owp-importing").text(i),n.allowPopupClosing=!0,l(".owp-demo-popup-close").fadeIn()}!0===e&&n.importContent(s)}}),p=setTimeout(function(){i.abort(),n.allowPopupClosing=!0,l(".owp-demo-popup-close").fadeIn(),l(".owp-importing").addClass("owp-importing-failed").removeClass("owp-importing").text(owpDemos.content_importing_error)},9e5)},closePopup:function(){l("html").css({overflow:"","margin-right":""}),l(".preview-icon").hide(),l(".preview-all").hide(),l("#owp-demo-popup-wrap").fadeOut(),setTimeout(function(){l("#owp-demo-popup-content").html("")},600)},installNow:function(t){t.preventDefault();var e=l(t.target),o=l(document);e.hasClass("updating-message")||e.hasClass("button-disabled")||(wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(t),o.on("credential-modal-cancel",function(){l(".install-now.updating-message").removeClass("updating-message").text(wp.updates.l10n.installNow),wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),wp.updates.installPlugin({slug:e.data("slug")}))},activatePlugins:function(t){t.preventDefault();var e=l(t.target),t=e.data("init");e.data("slug");e.hasClass("updating-message")||e.hasClass("button-disabled")||(e.addClass("updating-message button-primary").html(owpDemos.button_activating),l.ajax({url:owpDemos.ajaxurl,type:"POST",data:{action:"owp_ajax_required_plugins_activate",init:t}}).done(function(t){t.success&&e.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(owpDemos.button_active)}))},installSuccess:function(t,e){t.preventDefault();var o=l(".owp-plugin-"+e.slug).find(".button"),a=o.data("init");o.removeClass("install-now installed button-disabled updated-message").addClass("updating-message").html(owpDemos.button_activating),setTimeout(function(){l.ajax({url:owpDemos.ajaxurl,type:"POST",data:{action:"owp_ajax_required_plugins_activate",init:a}}).done(function(t){t.success?o.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(owpDemos.button_active):o.removeClass("updating-message")})},1200)},pluginInstalling:function(t,e){t.preventDefault(),l(".owp-plugin-"+e.slug).find(".button").addClass("updating-message")},installError:function(t,e){t.preventDefault(),l(".owp-plugin-"+e.slug).removeClass("button-primary").addClass("disabled").html(wp.updates.l10n.installFailedShort)}},e={init:function(){var e;l(".upload_image_button").on("click",function(t){t.preventDefault();t=l(this);name=t.attr("data-name"),e||(e=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1})).on("select",function(){var t=e.state().get("selection").first().toJSON();console.log(t),l("#"+name).val(t.id),l("#"+name+"-img").attr("src",t.url).show(),l('.remove_image_button[data-name="'+name+'"]').show()}),e.open()}),l(".remove_image_button").on("click",function(t){t.preventDefault();var e=l(this),t=e.attr("data-name");return l("#"+t).val(""),l("#"+t+"-img").attr("src","").hide(),e.hide(),!1}),0<l(".color-picker-field").length&&l(".color-picker-field").each(function(){l(this).wpColorPicker()})}}}(jQuery);